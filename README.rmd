---
title: "Data Science 871 project"
output: github_document
---

## Media Consumption and Willingness to upgrade internet package.

The purpose of this project is to use survey data in order to determine which factors are important predictors of whether individuals would be willing to upgrade their internet packages. All code and functions are stored under the "code" folder. This readme is solely for visualization of data and results.

```{r include=FALSE }

rm(list = ls()) 
gc()


library(tidyverse)
library(ggpubr)
library(hrbrthemes)
library(stringr)
library(ranger)
library(caret)
library(corrplot)
```

```{r include=FALSE}
initialDF <- read.csv('data/DeloitteMediaConsumptionSurvey.csv')
source('code/DataCleaningFunctions.R')
source('code/FeatureEngineering.R')
source('code/EDA.R')
source('code/Modeling.R')
#('code/', full.names = T, recursive = T) %>% .[grepl('.R', .)] %>% as.list() %>% walk(~source(.))
```

## Data loading and cleaning

The data set contains survey responses from 2131 individuals regarding demographic factors (age, sex, race, ect.), the types of apps they use, time spent on different devices, preferred type of media, and other issues regarding media consumption. I restrict this data set to include only responses from individuals that have internet access.

The features can be broadly broken down into 6 categories, namely demographic factors, technology owned by individuals, device usage, app usage, user subscriptions and lastly, what individuals' preferred form of entertainment are.

```{r}
NAs <- 0
for (i in 1:nrow(appDF)) {
    if (any(appDF[i,] == "#NULL!") == TRUE) {  #Checking how many users did not answer this question
        NAs <- NAs + 1
    }
}
NAs
```

Under closer inspection it would appear that a total of 412 survey respondents did not answer the question regarding app usage. Thus, for now, I exclude this feature from further analysis. Additionally, I exclude any individuals who do not have an internet connection as they serve no purpose in determining the target variable of upgrading internet.

##Target Variable The target variable is turned into a factor variable indicating a 1 if they are willing to upgrade their internet package and a 0 if they are not.

```{r}
Q29 <- masterDF[,151]

UpgradeInternet <- ifelse(Q29 == "I am not willing to pay more for faster download speeds as my current speed is sufficient for my needs" |
                  Q29 == "I prefer faster speed but I am unwilling to pay more than I already do", 0, 1)
UpgradeInternet <- as.factor(UpgradeInternet)
head(UpgradeInternet)
summary(UpgradeInternet)
```

In total 814 respondents indicated that they will not be willing to upgrade their internet package, while 744 respondents would.

## Exploratory Data analysis

### Demographics

Below are breakdowns of the demographic factors of the dataset.

```{r fig.height=6}
demogPlot
```

A large portion of individuals who participated in the survey are elderly, as can be seen from the Age distribution that peaks around late 60's to mid 70's. The surveyed is notably lacking in middle aged respondents. Gender is split rather equally. The vast majority of respondents were white and had an income ranging from \$50,000 to \$99,999.

### Univariate Analysis

Below follows univariate analysis for 3 crucial features in the model.

```{r}
techBar
```

Plotting technology ownership shows that the majority of respondents own:

-   DVD players
-   Desktop Computers
-   Flat Panel Televisions
-   Laptop Computers
-   Routers
-   Smartphones
-   Tablet

```{r}
watchBar
```

A plot of watch time of different forms of entertainment on different devices show TV's reign supreme, being the most used device to watch sport, movies and TV shows. Computer's/Laptop's are the second most used device across all entertainment, followed by smartphones and lastly tablets. This result indicates that the type of entertainment does not drastically impact the devices used. 

```{r}
subBar
```

Plotting household subscriptions shows that most individuals are subscribed to the following services:

- Landline Telephone
- Mobile data plan
- Mobile Voice
- PayTV

Notably, video streaming services are nearly 50/50.


### Bivariate Analysis

The density plots below shows a breakdown of individuals who would upgrade their internet package based on age, technology ownership and subscription ownership.

```{r}
ageDensityPlot
```

What is immediately clear from the graph above is the fact that younger people are far more likely to upgrade their internet speed. This peaks at around age 25. A large proportion of people who said no to upgrading their internet package are elderly.



```{r}
techDensityPlot
```

The density plot investigating technology ownership shows that the majority of people who said no, own few devices. In this survey atleast, people who own more devices are more likely to upgrade their internet speed.


```{r}
subDensityPlot
```

A similar story holds for subscriptions, with people who own more subscription are more likely to say yes.

The violin charts below shows a breakdown of people who are willing to pay for upgraded internet based on different forms of entertainment and the devices used to view them.

```{r, fig.width=8, fig.height=6}
plotViolins(movie_BIdf, "Watch Time per device vs Upgrading Internet - Movies")
plotViolins(tv_BIdf, "Watch Time per device vs Upgrading Internet - TV Shows")
plotViolins(sport_BIdf, "Watch Time per device vs Upgrading Internet - Sport")
```

Individuals who spent a significant amount of time watching Movies and TV Shows on a computer are more likely to be willing to upgrade. However, individuals who spend a large amount of consuming any form of entertainment on TV, are much more likely to say no to an upgrade. Smartphones and tablets provide less clear results for all forms of entertainment.

## Modeling

In order to predict which individuals are willing to upgrade their internet package I fit a Random Forest model. The target variable is the encoded as a 1 if the individual answered that they are willing to upgrade and 0 if they are not. A total of 89 features are used. The model is fitted using the ranger package.

### Baseline Model

The default model in the ranger package is used as the baseline model.
```{r}
paste("OOB Prediction Error:", round(rf1$prediction.error,3))
paste("RMSE:", round(sqrt(rf1$prediction.error),3))
rf1$confusion.matrix
```

```{r}
treePlot
```

### Hyperparatemer tuning

```{r}
TuneResult
```

### Final Model

```{r}
bestmod1$prediction.error
bestmod1$confusion.matrix
```

```{r}
conMat_train
conMat_test
```


```{r}
ImportancePlot
```

